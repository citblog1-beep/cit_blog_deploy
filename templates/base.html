<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />

  {# Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ #}
  <title>{% block title %}Ù…Ø¯ÙˆÙ†Ø© CIT{% endblock %}</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  {# ÙˆØµÙ Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© #}
  <meta name="description" content="{% block meta_description %}Ù…Ø¯ÙˆÙ†Ø© CIT Ù„Ù…Ø­ØªÙˆÙ‰ ØªÙ‚Ù†ÙŠ Ù…Ø¨Ø³Ù‘Ø· Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.{% endblock %}">

  {# ==== Open Graph (Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø·) ==== #}
  <meta property="og:title" content="{% block og_title %}Ù…Ø¯ÙˆÙ†Ø© CIT{% endblock %}">
  <meta property="og:description" content="{% block og_description %}Ù…Ø­ØªÙˆÙ‰ ØªÙ‚Ù†ÙŠ Ù…Ø¨Ø³Ù‘Ø·ØŒ Ø´Ø±ÙˆØ­Ø§Øª ÙˆØ¨Ø±Ø§Ù…Ø¬ ÙˆØªØ¬Ø§Ø±Ø¨ Ù…Ù† Ø¹Ø§Ù„Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ©.{% endblock %}">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ar_SA">
  <meta property="og:url" content="{{ request.url }}">
  <meta property="og:site_name" content="Ù…Ø¯ÙˆÙ†Ø© CIT">

  {# ==== Twitter Cards ==== #}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% block twitter_title %}Ù…Ø¯ÙˆÙ†Ø© CIT{% endblock %}">
  <meta name="twitter:description" content="{% block twitter_description %}Ù…Ø­ØªÙˆÙ‰ ØªÙ‚Ù†ÙŠ Ø¹Ø±Ø¨ÙŠ Ù…Ø¨Ø³Ù‘Ø· Ù…Ù† Ù…Ø¯ÙˆÙ†Ø© CIT.{% endblock %}">

  {# Ù…Ù„Ù Ø§Ù„Ù€ CSS Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ #}
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  {# Ù…ÙƒØ§Ù† Ù„Ø¥Ø¶Ø§ÙØ© CSS Ø¥Ø¶Ø§ÙÙŠ Ù…Ù† Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© #}
  {% block extra_css %}{% endblock %}

  {# JSON-LD ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµÙ‡ ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª (Ù…Ø«Ù„Ø§Ù‹ ØµÙØ­Ø© Ø§Ù„Ù…Ù‚Ø§Ù„) #}
  {% block jsonld %}{% endblock %}
</head>
<body>
<header class="site-header">
  <div class="container header-bar">

    <!-- ÙŠÙ…ÙŠÙ†: Ø§Ù„Ø´Ø¹Ø§Ø± -->
    <div class="header-right">
      <a href="{{ url_for('index') }}" class="logo-link">
        <img src="{{ url_for('static', filename='assets/logo/logo.png') }}"
             class="logo-img" alt="CIT Logo">
        <div class="logo-text-block">
          <span class="logo-text-main">CIT Blog</span>
          <span class="logo-text-sub">Ù…Ø­ØªÙˆÙ‰ ØªÙ‚Ù†ÙŠ Ù…Ø¨Ø³Ù‘Ø·</span>
        </div>
      </a>
    </div>

    <!-- Ø§Ù„Ù…Ù†ØªØµÙ: Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
    <nav class="main-nav">
      <a href="{{ url_for('index') }}"
         class="nav-link {% if request.path == url_for('index') %}is-active{% endif %}">
        Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </a>

      {% if categories %}
        {% for cat in categories %}
          <a href="/{{ cat.slug }}"
             class="nav-link {% if request.path == '/' + cat.slug %}is-active{% endif %}">
            {{ cat.name }}
          </a>
        {% endfor %}
      {% endif %}

      {% if is_admin and pending_count %}
        <a href="{{ url_for('pending_users') }}"
           class="nav-link badge-link">
          Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„ ({{ pending_count }})
        </a>
      {% endif %}
    </nav>

    <!-- Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„Ø¨Ø­Ø« + ØªØ§Ø¨Ø¹Ù†Ø§ + Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± + Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div class="header-actions">

      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø­Ø« -->
      <button type="button"
              class="icon-btn search-toggle"
              id="searchToggle"
              aria-label="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©">
        ğŸ”
      </button>

      <!-- Ø²Ø± ØªØ§Ø¨Ø¹Ù†Ø§ + Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© -->
      <div class="follow-menu">
        <button type="button" class="follow-btn">
          <span class="follow-plus">ï¼‹</span>
          <span>ØªØ§Ø¨Ø¹Ù†Ø§</span>
        </button>
        <div class="follow-dropdown">
          <a href="https://www.snapchat.com/add/cit.af?share_id=PI1obN8IQzeiXuLQkedVqw&locale=ar_SA@calendar=gregorian;numbers=latn"
             target="_blank" rel="noopener">
            ğŸ‘» Ø³Ù†Ø§Ø¨ Ø´Ø§Øª
            <span class="follow-handle">@CIT.AF</span>
          </a>
        </div>
      </div>

      {# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…Ø¯ÙŠØ± ÙÙ‚Ø·): Ø£Ù‚Ø³Ø§Ù… + Ù…Ù‚Ø§Ù„Ø§Øª + Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† #}
      {% if session.get('logged_in') and session.get('role') == 'admin' %}
        <div class="follow-menu settings-menu">
          <button type="button" class="follow-btn">
            âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          </button>
          <div class="follow-dropdown">
            <a href="{{ url_for('admin_categories') }}">ğŸ“‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</a>
            <a href="{{ url_for('admin_posts') }}">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</a>
            <a href="{{ url_for('admin_users') }}">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
          </div>
        </div>
      {% endif %}

      <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
      {% if session.get('logged_in') %}
        <span class="user-name">
          {{ session.get('username') }}
          {% if session.get('role') == 'admin' %}(Ù…Ø¯ÙŠØ±){% endif %}
        </span>

        <a href="{{ url_for('logout') }}" class="btn-link btn-small">Ø®Ø±ÙˆØ¬</a>

        {% if session.get('role') == 'admin' %}
          <a href="{{ url_for('form') }}" class="btn-link btn-small">
            â• Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯
          </a>
        {% endif %}
      {% else %}
        <a href="{{ url_for('auth_page') }}" class="btn-link btn-small">
          Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„
        </a>
      {% endif %}
    </div>

  </div>

  <!-- Popover Ø§Ù„Ø¨Ø­Ø« (ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø³Ø©) -->
  <div class="search-popover" id="searchPopover">
    <form action="{{ url_for('search') }}" method="get"
          class="search-popover-form">
      <input type="search" name="q"
             placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ù…Ø¯ÙˆÙ†Ø© CIT..."
             value="{{ request.args.get('q','') }}">
      <button type="submit">Ø¨Ø­Ø«</button>
    </form>
  </div>
</header>

  <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <main class="container">
    {# Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙ„Ø§Ø´ #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-area">
          {% for category, msg in messages %}
            <div class="flash flash-{{ category }}">{{ msg|safe }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <!-- Ø§Ù„ÙÙˆØªØ± -->
  <footer class="site-footer">
    <div class="footer-inner">
      <span class="footer-copy">
        Â© {{ current_year|default(2025) }} Ù…Ø¯ÙˆÙ†Ø© CIT â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
      </span>

      <span class="footer-separator">â€¢</span>

      <span class="footer-contact">
        Ù„Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø³Ù†Ø§Ø¨ Ø´Ø§Øª:
        <a
          href="https://www.snapchat.com/add/cit.af?share_id=PI1obN8IQzeiXuLQkedVqw&locale=ar_SA@calendar=gregorian;numbers=latn"
          target="_blank"
          rel="noopener noreferrer"
          class="footer-snap-link"
        >
          SNAP <span class="footer-snap-user">@CIT.AF</span>
        </a>
      </span>
    </div>

    <!-- ØµÙ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø«Ø§Ø¨ØªØ© -->
    <div class="footer-inner footer-links-row">
      <a href="{{ url_for('about_page') }}" class="footer-link">
        Ø¹Ù† Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©
      </a>
      <span class="footer-separator">â€¢</span>
      <a href="{{ url_for('privacy_page') }}" class="footer-link">
        Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
      </a>
      <span class="footer-separator">â€¢</span>
      <a href="{{ url_for('contact_page') }}" class="footer-link">
        ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
      </a>
    </div>
  </footer>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("searchToggle");
    const popover = document.getElementById("searchPopover");
    const input = popover ? popover.querySelector("input[type='search']") : null;

    if (!toggle || !popover) return;

    toggle.addEventListener("click", function (e) {
      e.stopPropagation();
      popover.classList.toggle("is-open");
      if (popover.classList.contains("is-open") && input) {
        setTimeout(function () { input.focus(); }, 60);
      }
    });

    document.addEventListener("click", function (e) {
      if (!popover.contains(e.target) && e.target !== toggle) {
        popover.classList.remove("is-open");
      }
    });
  });
  </script>

  {# Ù…ÙƒØ§Ù† Ù„Ø¥Ø¶Ø§ÙØ© JS Ø¥Ø¶Ø§ÙÙŠ Ù…Ù† Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© #}
  {% block extra_js %}{% endblock %}

</body>
</html>
